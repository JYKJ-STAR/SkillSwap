{% extends "shared/base.html" %}
{% block title %}SkillSwap - My Schedule{% endblock %}

{% block styles %}
<link href="{{ url_for('static', filename='css/youth/youth_schedule.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}
<!-- Back Button -->
<a href="{{ url_for('dashboard.dashboard') }}" class="back-btn" style="text-decoration:none;">
    <i class="bi bi-arrow-left"></i> Back
</a>

<!-- ========================================
     MAIN CONTENT
     ======================================== -->
<main class="main-container">
    <!-- Sidebar -->
    <aside class="rewards-sidebar">
        <div class="profile-avatar">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                <circle cx="12" cy="7" r="4" />
            </svg>
        </div>
        <h2 class="profile-name">{{ user.name if user else 'User' }}</h2>
        <p class="profile-age">{{ user.age if user and user.age else '' }} Years Old</p>
        <p class="profile-points" id="user-points" data-points="{{ user.points if user else 0 }}">
            {{ user.points if user else 0 }} Points
        </p>

        <a href="{{ url_for('rewards.rewards') }}" class="claim-rewards-btn"
            style="text-decoration: none; display: flex; justify-content: center; align-items: center;">
            Claim Rewards
        </a>

        <h3 class="sidebar-section-title">Skills</h3>
        <div class="skill-tags">
            {% if user and user.skills %}
            {% for skill in user.skills %}
            <span class="skill-tag">{{ skill }}</span>
            {% endfor %}
            {% else %}
            <span class="skill-tag">No skills added</span>
            {% endif %}
        </div>

        <h3 class="sidebar-section-title">Interests</h3>
        <div class="skill-tags">
            {% if user and user.interests %}
            {% for interest in user.interests %}
            <span class="skill-tag">{{ interest }}</span>
            {% endfor %}
            {% else %}
            <span class="skill-tag">No interests added</span>
            {% endif %}
        </div>
    </aside>

    <!-- Content - Schedule -->
    <section class="content">
        <h1 class="page-title">My Schedule</h1>

        <!-- Filter Tabs -->
        <div class="filter-tabs">
            <button class="filter-tab upcoming active">Upcoming</button>
            <button class="filter-tab waiting">Feedback</button>
            <button class="filter-tab completed">Completed</button>
        </div>

        <!-- UPCOMING EVENTS -->
        <div class="event-list" id="upcoming-view">
            {% if upcoming_events %}
            {% for event in upcoming_events %}
            <div class="event-card">
                <div class="event-thumbnail"></div>
                <div class="event-details">
                    <h3 class="event-title">{{ event.title }}</h3>
                    <p class="event-meta">
                        {{ event.display_date }} | {{ event.display_time }} | {{ event.location }}
                    </p>
                    <div class="event-actions">
                        <span class="info-badge">{{ event.points }} Points</span>
                        <span class="info-badge">{{ event.hours_earned or 2 }} Hours</span>
                    </div>
                </div>
                <!-- <span class="status-badge upcoming">Upcoming</span> -->
                <div class="event-icon-actions">
                    <button class="icon-btn delete" title="Withdraw" onclick="openModal('withdraw-modal')">üóë</button>
                </div>
            </div>
            {% endfor %}
            {% else %}
            <div class="text-muted text-center py-4">No upcoming events.</div>
            {% endif %}
        </div>

        <!-- WAITING FOR FEEDBACK VIEW -->
        <div id="waiting-view" style="display: none;">
            <!-- Action Required Section -->
            {% if action_required_events %}
            <h3 style="color: var(--text-dark); margin-bottom: 15px; font-size: 1.2rem;">Action Required</h3>
            <div class="event-list" style="margin-bottom: 30px;">
                {% for event in action_required_events %}
                <div class="event-card">
                    <div class="event-thumbnail"></div>
                    <div class="event-details">
                        <h3 class="event-title">{{ event.title }}</h3>
                        <p class="event-meta">{{ event.display_date }} | {{ event.role_type|capitalize }}</p>
                        <div class="event-actions" style="flex-wrap: wrap;">
                            <button class="log-reflection-btn js-open-feedback" data-id="{{ event.event_id }}"
                                data-title="{{ event.title }}">Log Reflection</button>
                            <button class="log-reflection-btn js-open-upload" style="background:#4a4a4a;"
                                data-id="{{ event.event_id }}" data-title="{{ event.title }}">Upload Proof</button>
                            <span class="points-badge">+{{ event.points or 100 }} Points</span>
                        </div>
                    </div>
                    <span class="status-badge pending">Action Required</span>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Pending Review Section -->
            {% if pending_review_events %}
            <h3 style="color: var(--text-dark); margin-bottom: 15px; font-size: 1.2rem;">Pending Admin Review</h3>
            <div class="event-list">
                {% for event in pending_review_events %}
                <div class="event-card">
                    <div class="event-thumbnail"></div>
                    <div class="event-details">
                        <h3 class="event-title">{{ event.title }}</h3>
                        <p class="event-meta">{{ event.display_date }}</p>
                        <p style="color: var(--primary-teal); font-weight: 600; margin-top: 5px;">Awaiting +{{
                            event.points or 100 }} Points</p>
                    </div>
                    <span class="status-badge" style="background: orange; color: white;">Pending Review</span>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            {% if not action_required_events and not pending_review_events %}
            <div class="text-muted text-center py-4">No feedback actions needed!</div>
            {% endif %}
        </div>

        <!-- COMPLETED EVENTS -->
        <div class="event-list" id="completed-view" style="display: none;">
            {% if completed_events %}
            {% for event in completed_events %}
            <div class="event-card">
                <div class="event-thumbnail"></div>
                <div class="event-details">
                    <h3 class="event-title">{{ event.title }}</h3>
                    <p class="event-meta">{{ event.display_date }}</p>
                </div>
                <span class="status-badge" style="background: #4ade80; color: white;">Verified</span>
            </div>
            {% endfor %}
            {% else %}
            <div class="text-muted text-center py-4">No completed events yet.</div>
            {% endif %}
        </div>
    </section>
</main>

<!-- ========================================
     MODALS
     ======================================== -->

<!-- FEEDBACK POPUP MODAL -->
<div class="modal-overlay" id="feedback-modal">
    <form class="modal" action="{{ url_for('schedule.submit_feedback') }}" method="POST">
        <input type="hidden" name="event_id" id="feedback_event_id">
        <!-- Back Link -->
        <a href="#" class="back-link close-modal" data-target="feedback-modal">‚Üê Back</a>

        <!-- Title -->
        <h2 class="modal-title">How was your Session?</h2>
        <h3 id="feedback-event-title" style="color: #4ade80; margin-bottom: 5px;"></h3>
        <p class="modal-subtitle">Your feedback help us improve</p>

        <!-- Star Rating -->
        <div class="star-rating">
            <span class="star" data-rating="1"></span>
            <span class="star" data-rating="2"></span>
            <span class="star" data-rating="3"></span>
            <span class="star" data-rating="4"></span>
            <span class="star" data-rating="5"></span>
        </div>
        <input type="hidden" name="rating" id="rating_input">

        <!-- Feedback Textarea -->
        <textarea name="comment" class="feedback-textarea" placeholder="Share your thoughts"></textarea>

        <!-- Points Indicator -->
        <p class="points-indicator">+100 Points</p>

        <!-- Submit Button -->
        <button type="submit" class="submit-btn">Submit and Claim Points</button>
    </form>
</div>

<!-- UPLOAD PHOTO POPUP MODAL -->
<div class="modal-overlay" id="upload-modal">
    <form class="modal" action="{{ url_for('schedule.upload_proof') }}" method="POST" enctype="multipart/form-data">
        <input type="hidden" name="event_id" id="upload_event_id">
        <!-- Back Link -->
        <a href="#" class="back-link close-modal" data-target="upload-modal">‚Üê Back</a>

        <!-- Title -->
        <h2 class="modal-title">Upload Photo with Attendees</h2>
        <h3 id="upload-event-title" style="color: #4ade80; margin-bottom: 5px;"></h3>
        <p class="modal-subtitle">Help us verify that u were here!</p>

        <!-- Upload Area -->
        <div class="upload-area" id="uploadArea">
            <div class="camera-icon">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <rect x="2" y="6" width="20" height="14" rx="2" ry="2" />
                    <circle cx="12" cy="13" r="4" />
                    <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                </svg>
            </div>
            <p class="upload-text">Click to upload photo ID</p>
            <p class="upload-format">JPG or PNG</p>
            <!-- File Input -->
            <input type="file" name="photo" class="file-input" id="fileInput" accept=".jpg,.jpeg,.png">
        </div>

        <!-- Preview Container -->
        <div class="preview-container" id="previewContainer">
            <img src="" alt="Preview" class="preview-image" id="previewImage">
            <p class="preview-name" id="previewName"></p>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="submit-btn">Submit Photo</button>
    </form>
</div>

<!-- WITHDRAW EVENT POPUP MODAL -->
<div class="modal-overlay" id="withdraw-modal">
    <div class="modal">
        <h2 class="modal-title">Withdraw from Event?</h2>
        <p class="modal-subtitle">It is sad to see you leave, would you tell us why</p>
        <div class="textarea-label">
            <span class="label-text">Reasoning</span>
            <textarea class="reasoning-textarea" placeholder=""></textarea>
        </div>
        <div class="button-container">
            <button type="button" class="btn btn-cancel close-modal" data-target="withdraw-modal">Change my
                mind</button>
            <button type="button" class="btn btn-withdraw" onclick="closeModal('withdraw-modal')">Withdraw
                event</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/youth/youth_schedule.js') }}"></script>
{% endblock %}